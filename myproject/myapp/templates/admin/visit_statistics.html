<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<h1>Статистика посещений</h1>

<h2>1. Планируемые посещения (группировка по клиентам)</h2>
<table border="1" cellpadding="5" cellspacing="0">
    <tr><th>Клиент</th><th>Количество посещений</th></tr>
    {% for visit in visits_by_client %}
    <tr>
        <td>{{ visit.client__first_name }} {{ visit.client__last_name }}</td>
        <td>{{ visit.visit_count }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="2">Данные отсутствуют</td></tr>
    {% endfor %}
</table>

<h2>2. Стоимость посещений клиента за период</h2>
<form method="get">
    <label>Клиент:
        <select name="client">
            <option value="">-- Выберите клиента --</option>
            {% for client in clients %}
            <option value="{{ client.id }}" {% if request.GET.client|stringformat:"s" == client.id|stringformat:"s" %}selected{% endif %}>
                {{ client.first_name }} {{ client.last_name }}
            </option>
            {% endfor %}
        </select>
    </label>
    <label>С <input type="date" name="start_date" value="{{ request.GET.start_date }}"></label>
    <label>По <input type="date" name="end_date" value="{{ request.GET.end_date }}"></label>
    <button type="submit">Показать</button>
</form>

{% if cost_by_doctor %}
<table border="1" cellpadding="5" cellspacing="0">
    <tr><th>Врач</th><th>Общая стоимость</th></tr>
    {% for cost in cost_by_doctor %}
    <tr>
        <td>{{ cost.schedule__doctor__first_name }} {{ cost.schedule__doctor__last_name }}</td>
        <td>{{ cost.total_cost }}</td>
    </tr>
    {% endfor %}
</table>
{% endif %}

<h2>3. Список клиентов, которым назначено посещение конкретного врача на дату</h2>
<form method="get">
    <label>Врач:
        <select name="doctor">
            <option value="">-- Выберите врача --</option>
            {% for doctor in doctors %}
            <option value="{{ doctor.id }}" {% if request.GET.doctor|stringformat:"s" == doctor.id|stringformat:"s" %}selected{% endif %}>
                {{ doctor.first_name }} {{ doctor.last_name }}
            </option>
            {% endfor %}
        </select>
    </label>
    <label>Дата:
        <input type="date" name="visit_date" value="{{ request.GET.visit_date }}">
    </label>
    <button type="submit">Показать</button>
</form>

{% if clients_for_doctor_date %}
<table border="1" cellpadding="5" cellspacing="0">
    <tr><th>Клиент</th></tr>
    {% for c in clients_for_doctor_date %}
    <tr><td>{{ c.client__first_name }} {{ c.client__last_name }}</td></tr>
    {% endfor %}
</table>
{% endif %}

<h2>4. Все клиенты заданного врача</h2>
<form method="get">
    <label>Врач:
        <select name="doctor">
            <option value="">-- Выберите врача --</option>
            {% for doctor in doctors %}
            <option value="{{ doctor.id }}" {% if request.GET.doctor|stringformat:"s" == doctor.id|stringformat:"s" %}selected{% endif %}>
                {{ doctor.first_name }} {{ doctor.last_name }}
            </option>
            {% endfor %}
        </select>
    </label>
    <button type="submit">Показать</button>
</form>

{% if all_clients_for_doctor %}
<table border="1" cellpadding="5" cellspacing="0">
    <tr><th>Клиент</th></tr>
    {% for client in all_clients_for_doctor %}
    <tr><td>{{ client.first_name }} {{ client.last_name }}</td></tr>
    {% endfor %}
</table>
{% endif %}

{% endblock %}

</body>
</html>